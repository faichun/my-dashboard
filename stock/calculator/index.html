<!DOCTYPE html>
<html lang="en">

<HEAD>
  <title>香港股市 - 成本計算機 (VER 4)</title>
  <meta charset="utf-8" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
  <meta http-equiv="pragma" content="no-cache" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <!-- Popper JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <!-- Latest compiled JavaScript -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</HEAD>

<script language="javascript">
var ie4 = (document.all) ? true : false;
var ns4 = (document.layers) ? true : false;
var ns6 = (document.getElementById && !document.all) ? true : false;

//**************************************************************
function loadDefaultValue() {
  document.aForm.reset();
  document.aForm.min_commission.value = "100";
  document.aForm.commission_rate.value = "0.25";
  document.aForm.matrixFactor.value = "0.05";
  document.aForm.matrixSize.value = "3";
}

//**************************************************************
function calculateBuyingCost(price,quantity) {
    var Gross = 0;
    Gross = Math.round(price * quantity * 1000)/1000;
    N = Math.round((Gross + calculateFee(price,quantity)) * 1000) / 1000;
    return N;
}

//**************************************************************
function calculateSellingCost(price,quantity) {
    var Gross = 0;
    Gross = Math.round(price * quantity * 1000)/1000;
    N = Math.round((Gross - calculateFee(price,quantity)) * 1000) / 1000;
    return N;
}

//**************************************************************
function calculateFee(price,quantity) {

    var CommRate = 0, MinComm = 0;
    var Gross = 0, Commission = 0, Levy = 0, Stamp = 0, Trading = 0, CA = 0, N = 0;

    CommRate = document.aForm.commission_rate.value;
    MinComm = document.aForm.min_commission.value;

    Gross = Math.round(price * quantity*1000)/1000;
    Commission = Math.round((Gross * CommRate / 100)*1000) / 1000;
    if (Commission < MinComm && Commission > 0) {
       Commission = eval(MinComm);
    }

    Levy = Math.round(Gross * 0.00004 * 100) / 100;
    Stamp = Math.round(Math.ceil(Gross * 0.001));
    if (Stamp <= 2 && Stamp > 0) { Stamp = 2; }

    Trading = Math.round(Gross * 0.00005 * 100) / 100;
    CA = Math.round(Gross * 0.00002 * 100) / 100;

    if (CA >= 100) {
       CA = 100;
    } else if (CA <= 2 && CA > 0) {
       CA = 0;
    }

    return Math.round((Commission + Levy + Stamp + Trading + CA) * 100) / 100;
}

//**************************************************************
function goSubmit() {
  setBuyingCostDetails();
  setSellingCostDetails();
  document.aForm.net_amount_diff.value = Math.round((document.aForm.net_amount_sell.value - document.aForm.net_amount_buy.value) * 1000) / 1000;
  document.aForm.quantity.focus();
  return false;
}

//**************************************************************
function setBuyingCostDetails() {

    var CommRate = 0, MinComm = 0;
    var Gross = 0, Commission = 0, Levy = 0, Stamp = 0, Trading = 0, CA = 0, N = 0;

    CommRate = document.aForm.commission_rate.value;
    MinComm = document.aForm.min_commission.value;

    Gross = Math.round(document.aForm.price_buy.value * document.aForm.quantity.value*1000)/1000;
    Commission = Math.round((Gross * CommRate / 100)*1000) / 1000;
    if (Commission < MinComm && Commission > 0) {
       Commission = eval(MinComm);
    }

    Levy = Math.round(Gross * 0.00004 * 100) / 100;
    Stamp = Math.round(Math.ceil(Gross * 0.001));
    if (Stamp <= 2 && Stamp > 0) { Stamp = 2; }

    Trading = Math.round(Gross * 0.00005 * 100) / 100;
    CA = Math.round(Gross * 0.00002 * 100) / 100;

    if (CA >= 100) {
       CA = 100;
    } else if (CA <= 2 && CA > 0) {
       CA = 0;
    }

    N = Math.round((Gross + Commission + Levy + Stamp + Trading + CA) * 1000) / 1000;

    document.aForm.gross_amount_buy.value = Gross;
    document.aForm.commission_amount_buy.value = Commission;
    document.aForm.levy_buy.value = Levy;
    document.aForm.stamp_duty_buy.value = Stamp;
    document.aForm.Trading_fee_buy.value = Trading;
    document.aForm.ccass_buy.value = CA;
    document.aForm.net_amount_buy.value = N;
}

//**************************************************************
function setSellingCostDetails() {

    var CommRate = 0, MinComm = 0;
    var Gross = 0, Commission = 0, Levy = 0, Stamp = 0, Trading = 0, CA = 0, N = 0;

    CommRate = document.aForm.commission_rate.value;
    MinComm = document.aForm.min_commission.value;

    Gross = Math.round(document.aForm.price_sell.value * document.aForm.quantity.value*1000)/1000;
    Commission = Math.round((Gross * CommRate / 100)*1000) / 1000;
    if (Commission < MinComm && Commission > 0) {
       Commission = eval(MinComm);
    }

    Levy = Math.round(Gross * 0.00004 * 100) / 100;
    Stamp = Math.round(Math.ceil(Gross * 0.001));
    if (Stamp <= 2 && Stamp > 0) { Stamp = 2; }

    Trading = Math.round(Gross * 0.00005 * 100) / 100;
    CA = Math.round(Gross * 0.00002 * 100) / 100;

    if (CA >= 100) {
       CA = 100;
    } else if (CA <= 2 && CA > 0) {
       CA = 2;
    }

    N = Math.round((Gross - Commission - Levy - Stamp - Trading - CA) * 100) / 100;

    document.aForm.gross_amount_sell.value = Gross;
    document.aForm.commission_amount_sell.value = Commission;
    document.aForm.levy_sell.value = Levy;
    document.aForm.stamp_duty_sell.value = Stamp;
    document.aForm.Trading_fee_sell.value = Trading;
    document.aForm.ccass_sell.value = CA;
    document.aForm.net_amount_sell.value = N;
}

var MsgText = new Array();
MsgText['ERR000001'] = "(ERR000001)";
MsgText['ERR000002'] = "(ERR000002)";
MsgText['ERR000003'] = "(ERR000003)";
MsgText['ERR000004'] = "(ERR000004)";
MsgText['ERR000005'] = "(ERR000005)";

</script>
<style>
html {
  font-size: 14px;
}
</style>
<body onload="javascript: loadDefaultValue();">
<div class="container-fluid">
<form name="aForm" onsubmit="javascript: return goSubmit();">
  <input type="hidden" name="matrixFactor" value="" />
  <input type="hidden" name="matrixSize" value="" />
  <table class="table">
    <thead class="thead-dark">
      <tr><th>市 場</th><th>購 買 數 量</th><th>每 股 買 入 作 價</th><th>每 股 賣 出 作 價</th></tr>
    </thead>
    <tbody>
      <tr>
        <td><INPUT TYPE="hidden" NAME="market" VALUE="hk" />香 港</td>
        <td><INPUT TYPE="text" size="10" NAME="quantity" MAXLENGTH="6" /></td>
        <td><INPUT TYPE="text" size="10" NAME="price_buy" MAXLENGTH="6" /></td>
        <td><INPUT TYPE="text" size="10" NAME="price_sell" MAXLENGTH="6" /></td>
      </tr>
    </tbody>
    <thead class="thead-dark">
      <tr><th>最 低 佣 金</th><th>佣 金 利 率</th><th colspan="2"></th></tr>
    </thead>
    <tbody>
      <tr>
        <td><INPUT TYPE="text" size="10" NAME="min_commission" MAXLENGTH="8" /></td>
        <td><INPUT TYPE="text" size="10" NAME="commission_rate" MAXLENGTH="8" /></td>
        <td colspan="2">
          <INPUT TYPE="submit" NAME="Calculate" VALUE="計 算" WIDTH="70" STYLE="font-size:9;color:#3333DD;WIDTH:70">
          <INPUT TYPE="button" NAME="Reset" VALUE="重 設" WIDTH="70" STYLE="font-size:9;color:#3333DD;WIDTH:70" ONCLICK="javascript: loadDefaultValue();">
        </td>
      </tr>
    </tbody>
    <thead class="thead-dark">
      <tr><th colspan="4">估 計 所 需 款 項 計 算 機</th></tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="2">款 項 總 額</td>
        <td><INPUT NAME="gross_amount_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="gross_amount_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="2">佣 金</td>
        <td><INPUT NAME="commission_amount_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="commission_amount_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="2">交 易 徵 費</td>
        <td><INPUT NAME="levy_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="levy_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="2">印 花 稅</td>
        <td><INPUT NAME="stamp_duty_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="stamp_duty_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="2">交 易 費</td>
        <td><INPUT NAME="Trading_fee_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="Trading_fee_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="2">中 央 結 算 費</td>
        <td><INPUT NAME="ccass_buy" SIZE="9" MAXLENGTH="8"></td>
        <td><INPUT NAME="ccass_sell" SIZE="9" MAXLENGTH="8"></td>
      </tr>
    </tbody>
    <thead class="thead-dark">
      <tr>
        <th colspan="2">總 額 *</th>
        <th><INPUT NAME="net_amount_buy" SIZE="9" MAXLENGTH="8"></th>
        <th><INPUT NAME="net_amount_sell" SIZE="9" MAXLENGTH="8"></th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td colspan="3">買 入 賣 出 差 額 *</td>
        <td><INPUT NAME="net_amount_diff" SIZE="9" MAXLENGTH="8"></td>
      </tr>
      <tr>
        <td colspan="4">* 參考資料只適用於限價盤</td>
      </tr>
    </tbody>
  </table>
</form>
</div>
</body>
</html>
